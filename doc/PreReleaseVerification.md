# ThinBridge リリース前検証手順

## 検証環境の用意

* Thunderbird 128を使用する。
* 検証用メールアカウントとして、2つの異なるドメインで、複数のメールアカウントを用意する。
  * `@clear-code.com`
    * `piro-test@clear-code.com`
    * `piro-test+...@clear-code.com`
  * `@gmail.com`
    * `piro.outsider.reflex@gmail.com`
    * `piro.outsider.reflex+...@gmail.com`
* 検証用プロファイルを用意する。
  * 検証用メールアカウント（`piro-test@clear-code.com`）を作成する。
    * inbox配下のemlファイルを受信トレイまたは通常のメールフォルダーにドラッグ＆ドロップしてインポートする。
    * draft配下のemlファイルを下書きフォルダーにドラッグ＆ドロップしてインポートする。
  * FlexConfirmMailをインストールする。
    * FlexConfirmMailの設定画面において、`flexconfirmmail.json`をインポートする。


## 検証手順

Thunderbirdを起動し、以下の検証を実施する。

### 基本の動作

1. 新規にメール作成を開始する。
2. 宛先に `piro-test+1@clear-code.com, piro.outsider.reflex@gmail.com` を追加する。
3. 件名、本文を「社内外宛」と入力する。
4. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
   * [ ] 「送信」がグレイアウトしている。
5. すべてのチェックをオンにする。
   * [ ] すべてにチェックが入った時点で「送信」が有効になる。
6. 「送信」を押す。
   * [ ] カウントダウンが表示される。
7. 「今すぐ送信」を押す
   * [ ] メールが実際に送信される。

### 送信前確認の動作

#### 宛先の分類

1. 新規にメール作成を開始する。
2. 宛先に `piro-test+1@clear-code.com, piro.outsider.reflex+1@gmail.com, piro.outsider.reflex+1.clear.code@gmail.com, user1@example.com` を追加する。
3. Ccに `piro-test+2@clear-code.com, piro.outsider.reflex+2@gmail.com, piro.outsider.reflex+2.clear.code@gmail.com, user2@example.com` を追加する。
4. Bccに `piro-test+3@clear-code.com, piro.outsider.reflex+3@gmail.com, piro.outsider.reflex+3.clear.code@gmail.com, user3@example.com` を追加する。
3. 件名、本文を「社内外宛」と入力する。
4. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
   * [ ] 「送信」がグレイアウトしている。
   * [ ] 組織内の宛先として以下が列挙されている。
     * `piro-test+1@clear-code.com`
     * `piro.outsider.reflex+1.clear.code@gmail.com`
     * `piro-test+2@clear-code.com`
     * `piro.outsider.reflex+2.clear.code@gmail.com`
     * `piro-test+3@clear-code.com`
     * `piro.outsider.reflex+3.clear.code@gmail.com`
   * [ ] 組織外の宛先として以下がグループ化され列挙されている。
     * `gmail.com`
       * `piro.outsider.reflex+1@gmail.com`
       * `piro.outsider.reflex+2@gmail.com`
       * `piro.outsider.reflex+3@gmail.com`
     * `example.com`
       * `user1@example.com`
       * `user2@example.com`
       * `user3@example.com`
5. 組織外の宛先のすべてのチェックをオンにする。
   * [ ] 「送信」がグレイアウトしている。
6. 組織内の宛先の見出し部分のチェックボックスをオンにする。
   * [ ] 組織内の宛先全てにチェックが付く。
   * [ ] 「送信」が有効になる。
7. 組織内の宛先の見出し部分のチェックボックスをオフにする。
   * [ ] 組織内の宛先全てのチェックが外れる。
   * [ ] 「送信」がグレイアウトしている。
8. 「キャンセル」を押して確認のダイアログを閉じる。
9. メール編集ウィンドウを閉じる。


#### 宛先を変更せずそのまま送信した場合に確認を省略する

1. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
2. 本文を「宛先を変更せずそのまま返信」と入力する。
3. 「送信」を押す
   * [ ] チェックボックスがある確認画面が開かれない。
   * [ ] カウントダウンが表示される。
4. 「キャンセル」を押して確認のダイアログを閉じる。
5. メール編集ウィンドウを閉じる。

#### 宛先を追加して送信した場合に確認を行う

1. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
2. 宛先に `piro-test+1@clear-code.com` を追加する。
3. 本文を「宛先を追加して返信」と入力する。
4. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
5. 「キャンセル」を押して確認のダイアログを閉じる。
6. メール編集ウィンドウを閉じる。

#### 他のメールの本文を貼り付けた場合に確認を行う

1. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
2. Thunderbirdのメイン画面に切り替える。
3. 「社外秘のメール」を選択する。
4. 「社外秘～」の部分を選択して、右クリックメニューから「コピー」を実行する。
5. メール編集画面に戻る。
6. 本文に「貼り付け」する。
7. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
8. 「キャンセル」を押して確認のダイアログを閉じる。
9. メール編集ウィンドウを閉じる。

#### すべての宛先が社内である場合に確認を省略する

1. 新規にメール作成を開始する。
2. 宛先に `piro-test+1@clear-code.com, piro-test+2@clear-code.com, piro-test+3@clear-code.com` を追加する
5. 件名、本文に「社内宛」と入力する
6. 「送信」を押す
   * [ ] チェックボックスがある確認画面が開かれない。
   * [ ] カウントダウンが表示される。
7. 「キャンセル」を押して確認のダイアログを閉じる。
8. メール編集ウィンドウを閉じる。

#### 添付ファイルがある場合に確認を行う

1. 新規にメール作成を開始する。
2. 画像ファイル `attachment/image.svg` を添付する。
3. 宛先に `piro-test+1@clear-code.com, piro.outsider.reflex@gmail.com` を追加する。
4. 件名、本文に「添付あり」と入力する。
5. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
   * [ ] 各添付ファイルにチェックボックスが表示されている。
6. すべてのチェックをオンにする。
   * [ ] すべてにチェックが入った時点で「送信」が有効になる。
7. 「キャンセル」を押して確認のダイアログを閉じる。
8. メール編集ウィンドウを閉じる。

#### 既存メールへの返信で、既存の宛先にないドメインの宛先が追加されたときに再確認を行う

1. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
2. 本文に「関係者を追加」と入力する。
3. 宛先に `piro-test+1@clear-code.com` を追加する。
4. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
5. すべてのチェックをオンにする。
   * [ ] すべてにチェックが入った時点で「送信」が有効になる。
6. 「送信」を押す
   * [ ] 追加された宛先の再確認を求めるダイアログが表示される。
7. 「キャンセル」を押して再確認のダイアログを閉じる。
8. 「キャンセル」を押して確認のダイアログを閉じる。
10. メール編集ウィンドウを閉じる。

#### 添付ファイルが特定のパターンに合致している（サーバー側で自動的に暗号化するようなソリューションを使っていて、普段はすべての添付ファイルが暗号化されるが、一部のファイルだけは暗号化処理の対象外になるので手動で暗号化する必要があり、その注意喚起を行う、といった場合）ときに再確認を行う

1. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
2. 宛先に `piro-test+1@clear-code.com` を追加する。
3. `json.zip` を添付する。
4. 「送信」を押す
   * [ ] チェックボックスがある確認画面が開かれる。
5. すべてのチェックをオンにする。
   * [ ] すべてにチェックが入った時点で「送信」が有効になる。
6. 「送信」を押す
   * [ ] 添付ファイルの再確認を求めるダイアログが表示される。
7. 「キャンセル」を押して再確認のダイアログを閉じる。
8. 「キャンセル」を押して確認のダイアログを閉じる。
10. メール編集ウィンドウを閉じる。

### 送信前カウントダウンの動作

#### カウントダウン秒数を変更する/カウントダウンを省略できないようにする

1. FlexConfirmMailの設定画面を開く。
2. 「その他」→「[送信]ボタンを押してからN秒間のカウントダウン語に実際に送信する」の秒数を「300」に変更する。
3. 「その他」→「カウントを飛ばしてすぐに送信することを許容する」のチェックを外す。
4. 3ペインのタブに切り替える。
5. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
6. 「送信」を押す。
   * [ ] 送信前確認のダイアログが開かれない。
   * [ ] カウントダウンが表示される。
   * [ ] カウントダウンの残り秒数が300から始まっている。
   * [ ] カウントダウンのダイアログに「キャンセル」ボタンのみがあり、カウントを省略するボタンがない。
7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
8. 「キャンセル」を押して確認のダイアログを閉じる。
9. メール編集ウィンドウを閉じる。

### 表示・確認対象のカスタマイズ

#### 件名、本文の確認

1. FlexConfirmMailの設定画面を開く。
2. 「その他」→「件名の確認を求める」にチェックを入れる。
3. 「その他」→「メール本文の確認を求める」にチェックを入れる。
4. 3ペインのタブに切り替える。
5. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
6. 宛先に `piro-test+1@clear-code.com, piro.outsider.reflex@gmail.com` を追加する。
7. 件名に「社外秘の重要な件名」と入力する。
8. 本文に「社外秘の重要な内容」と入力する。
9. 「送信」を押す
   * [ ] チェックボックスがある確認画面が開かれる。
   * [ ] 件名の確認欄があり、件名が「社外秘の重要な件名」となっている。
   * [ ] 本文の確認欄があり、内容が「社外秘の重要な内容」となっている。
10. すべてのチェックをオンにする。
    * [ ] すべてにチェックが入った時点で「送信」が有効になる。
11. 「キャンセル」を押して確認のダイアログを閉じる。
12. メール編集ウィンドウを閉じる。

#### 強調表示の切り替え

1. FlexConfirmMailの設定画面を開く。
2. 「その他」→「外部の宛先のアドレスを強調表示する」にチェックを入れる。
3. 「その他」→「メールアドレスを大きなフォントサイズで表示する」にチェックを入れる。
4. 「その他」→「確認のダイアログの冒頭メッセージ」に「送信前にご確認ください！！」と入力する。
5. 3ペインのタブに切り替える。
6. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
7. 宛先に `mail@example.com` を追加する。
8. 「送信」を押す
   * [ ] チェックボックスがある確認画面が開かれる。
   * [ ] ダイアログ最上部に「送信前にご確認ください！！」と表示されている。
   * [ ] 組織外の宛先のグループが偶数・奇数で色分け表示されている。
   * [ ] 組織外の宛先が大きなサイズの文字で標示されている。
9. すべてのチェックをオンにする。
    * [ ] すべてにチェックが入った時点で「送信」が有効になる。
10. 「キャンセル」を押して確認のダイアログを閉じる。
11. メール編集ウィンドウを閉じる。
