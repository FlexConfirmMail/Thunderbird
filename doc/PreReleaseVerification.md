# ThinBridge リリース前検証手順

## 検証環境の用意

* Thunderbird 128を使用する。
  * [日本語版（`ja`）](https://releases.mozilla.org/pub/thunderbird/releases/128.8.0esr/win64/ja/)、[英語版（`en-US`）](https://releases.mozilla.org/pub/thunderbird/releases/128.8.0esr/win64/en-US/)、[簡体中国語版（`zh-CN`）](https://releases.mozilla.org/pub/thunderbird/releases/128.8.0esr/win64/zh-CN/)の3つをインストールする。
  * 手順上で特に断りが無い場合、検証は日本語版で行う。
* 検証用メールアカウントとして、2つの異なるドメインで、複数のメールアカウントを用意する。
  * `@clear-code.com`
    * `piro-test@clear-code.com`
    * `piro-test+...@clear-code.com`
  * `@gmail.com`
    * `piro.outsider.reflex@gmail.com`
    * `piro.outsider.reflex+...@gmail.com`
* 検証用プロファイルを用意する。
  * 検証用メールアカウント（`piro-test@clear-code.com`）を作成する。
    * inbox配下のemlファイルを受信トレイまたは通常のメールフォルダーにドラッグ＆ドロップしてインポートする。
    * draft配下のemlファイルを下書きフォルダーにドラッグ＆ドロップしてインポートする。
  * 以下の内容のメーリングリストを作成する。
    * 名前：`gmail mailing list`
      * 説明文：`メーリング リスト`
      * メンバー：`piro.outsider.reflex+1@gmail.com`、`piro.outsider.reflex+2@gmail.com`、`piro.outsider.reflex+3@gmail.com`
    * 名前：`example mailing list`
      * 説明文：`メーリング リスト`
      * メンバー：`user1@example.com`、`user2@example.com`、`user3@example.com`
  * FlexConfirmMailをインストールする。
    * このリポジトリーの最上位ディレクトリーで `make` を実行してローカルでビルドしたXPI、もしくはGitHub ActionsのArtifactからダウンロードしたXPIを拡張機能の管理画面にドラッグ＆ドロップしてインストールする。
    * FlexConfirmMailの設定画面において、「開発者向け」→「デバッグモード」を有効にして、「Reset All」をクリックして設定を初期化した上で、再度「デバッグモード」を有効にして、「Import」をクリックして`flexconfirmmail.json`をインポートする。


## 検証手順

Thunderbirdを起動し、以下の検証を実施する。

### 基本の動作

1. 新規にメール作成を開始する。
2. 宛先に `piro-test+1@clear-code.com, piro.outsider.reflex@gmail.com` を追加する。
3. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
   * [ ] 「送信」がグレイアウトしている。
4. すべてのチェックをオンにする。
   * [ ] すべてにチェックが入った時点で「送信」が有効になる。
5. 「送信」を押す。
   * [ ] カウントダウンが表示される。
6. 「今すぐ送信」を押す
   * [ ] メールが実際に送信される。

### 送信前確認の動作

以下、設定画面上に記載がある機能を原則として上から順に検証する。

#### 宛先の分類と一括チェック

1. FlexConfirmMailの設定画面を開く。
2. 「宛先」→「外部の宛先の一括チェックを許可」にチェックを入れる。
3. 新規にメール作成を開始する。
4. 宛先に `piro-test+1@clear-code.com, piro.outsider.reflex+1@gmail.com, piro.outsider.reflex+1.clear.code@gmail.com, user1@example.com` を追加する。
5. Ccに `piro-test+2@clear-code.com, piro.outsider.reflex+2@gmail.com, piro.outsider.reflex+2.clear.code@gmail.com, user2@example.com` を追加する。
6. Bccに `piro-test+3@clear-code.com, piro.outsider.reflex+3@gmail.com, piro.outsider.reflex+3.clear.code@gmail.com, user3@example.com` を追加する。
7. 「送信」を押す。
   * [ ] チェックボックスがある確認画面が開かれる。
   * [ ] 「送信」がグレイアウトしている。
   * [ ] 組織内の宛先の見出し部分にチェックボックスがある。
   * [ ] 組織内の宛先として以下が列挙される。
     * `piro-test+1@clear-code.com`
     * `piro.outsider.reflex+1.clear.code@gmail.com`
     * `piro-test+2@clear-code.com`
     * `piro.outsider.reflex+2.clear.code@gmail.com`
     * `piro-test+3@clear-code.com`
     * `piro.outsider.reflex+3.clear.code@gmail.com`
   * [ ] 組織外の宛先の見出し部分にチェックボックスがある。
   * [ ] 組織外の宛先として以下がグループ化され列挙される。
     * `gmail.com`
       * `piro.outsider.reflex+1@gmail.com`
       * `piro.outsider.reflex+2@gmail.com`
       * `piro.outsider.reflex+3@gmail.com`
     * `example.com`
       * `user1@example.com`
       * `user2@example.com`
       * `user3@example.com`
8. 組織内の宛先の見出し部分のチェックボックスをオンにする。
   * [ ] 組織内の宛先全てにチェックが付く。
   * [ ] 「送信」がグレイアウトしている。
9. 組織外の宛先の見出し部分のチェックボックスをオンにする。
   * [ ] 組織外の宛先全てにチェックが付く。
   * [ ] 「送信」が有効になる。
10. 組織外の宛先の見出し部分のチェックボックスをオフにする。
    * [ ] 組織外の宛先全てのチェックが外れる。
    * [ ] 「送信」がグレイアウトしている。
11. 組織内の宛先の見出し部分のチェックボックスをオフにする。
    * [ ] 組織内の宛先全てのチェックが外れる。
    * [ ] 「送信」がグレイアウトしている。
12. 組織外の宛先の見出し部分のチェックボックスをオンにする。
    * [ ] 組織外の宛先全てにチェックが付く。
    * [ ] 「送信」がグレイアウトしている。
13. 組織内の宛先の見出し部分のチェックボックスをオンにする。
    * [ ] 組織内の宛先全てのチェックが外れる。
    * [ ] 「送信」が有効になる。
14. 「キャンセル」を押して確認のダイアログを閉じる。
15. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
16. 「宛先」→「組織内の宛先の一括チェックを許可」のチェックを外す。
17. 「宛先」→「外部の宛先の一括チェックを許可」のチェックを外す。
18. メール編集ウィンドウに戻る。
19. 「送信」を押す。
    * [ ] チェックボックスがある確認画面が開かれる。
    * [ ] 「送信」がグレイアウトしている。
    * [ ] 組織内の宛先の見出し部分にチェックボックスがない。
    * [ ] 組織内の宛先として以下が列挙される。
      * `piro-test+1@clear-code.com`
      * `piro.outsider.reflex+1.clear.code@gmail.com`
      * `piro-test+2@clear-code.com`
      * `piro.outsider.reflex+2.clear.code@gmail.com`
      * `piro-test+3@clear-code.com`
      * `piro.outsider.reflex+3.clear.code@gmail.com`
    * [ ] 組織外の宛先の見出し部分にチェックボックスがない。
    * [ ] 組織外の宛先として以下がグループ化され列挙される。
      * `gmail.com`
        * `piro.outsider.reflex+1@gmail.com`
        * `piro.outsider.reflex+2@gmail.com`
        * `piro.outsider.reflex+3@gmail.com`
      * `example.com`
        * `user1@example.com`
        * `user2@example.com`
        * `user3@example.com`
20. 「キャンセル」を押して確認のダイアログを閉じる。
21. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
22. 「宛先」→「組織内の宛先の一括チェックを許可」のチェックを入れる。
23. メール編集ウィンドウに戻る。
24. 宛先、Cc、Bccを全て消去する。
25. 宛先に `gmail mailing list <メーリング リスト>` を追加する。
26. Ccに `example mailing list <メーリング リスト>` を追加する。
27. 「送信」を押す。
    * [ ] チェックボックスがある確認画面が開かれる。
    * [ ] 組織外の宛先として以下がグループ化され列挙される。
      * `gmail.com`
        * `piro.outsider.reflex+1@gmail.com`
        * `piro.outsider.reflex+2@gmail.com`
        * `piro.outsider.reflex+3@gmail.com`
      * `example.com`
        * `user1@example.com`
        * `user2@example.com`
        * `user3@example.com`
28. 「キャンセル」を押して確認のダイアログを閉じる。
29. メール編集ウィンドウを閉じる

#### 送信前の宛先確認を行うかどうかの判断

1. 常に送信確認が行われる動作を検証する。
   1. FlexConfirmMailの設定画面を開く。
   2. 「宛先」→「送信前の宛先確認」→「常に確認」を選択する。
   3. 3ペインのタブに切り替える。
   4. 新規にメール作成を開始する。
   5. 宛先に `piro-test+1@clear-code.com` を追加する。
   6. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
   7. 「キャンセル」を押して確認のダイアログを閉じる。
2. 常に送信確認が行われない動作を検証する。
   1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   2. 「宛先」→「送信前の宛先確認」→「確認しない」を選択する。
   3. メール編集ウィンドウに戻る。
   4. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれない。
      * [ ] カウントダウンが表示される。
   5. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   6. メール編集ウィンドウを閉じる。
3. 誤送信の危険性がある場合だけ確認する動作を検証する。
   1. 確認が行われない場合を検証する。
      1. FlexConfirmMailの設定画面を開く。
      2. 「宛先」→「送信前の宛先確認」→「誤送信の危険性がある場合だけ確認」を選択する。
      3. 3ペインのタブに切り替える。
      4. 「社外の人とのやり取りのメール」を選択し、「返信」ボタンを押す。
      5. 本文に「本文」と入力する。
      6. 「送信」を押す。
         * [ ] 送信前確認のダイアログが開かれない。
         * [ ] カウントダウンが表示される。
      7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   2. 宛先の編集で確認が行われる場合を検証する。
      1. 宛先に `piro-test+1@clear-code.com` を追加する。
      2. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
      3. 「キャンセル」を押して確認のダイアログを閉じる。
      4. メール編集ウィンドウを閉じる。
   3. 異なる宛先を持つメールからテキストをコピー＆ペーストした場合を検証する。
      1. 「社外の人とのやり取りのメール」を選択し、「返信」ボタンを押す。
      2. 「社外秘のメール」を選択し、本文から「社内」の2文字をコピーする。
      3. 先に開いたメール編集ウィンドウの本文に、「社内」の2文字を貼り付ける。
      4. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
      5. 「キャンセル」を押して確認のダイアログを閉じる。
      6. メール編集ウィンドウを閉じる。
   4. 外部からテキストをコピー＆ペーストした場合を検証する。
      1. 「社外の人とのやり取りのメール」を選択し、「返信」ボタンを押す。
      2. Thunderbird以外のアプリケーションから任意のテキストを10文字程度コピーし、本文に貼り付ける。
         * 「社外秘」という文字列が含まれると別の送信前確認に該当してしまうため、「社外秘」という文字列は含めないようにする。
      3. 「送信」を押す。
         * [ ] 送信前確認のダイアログが開かれない。
         * [ ] カウントダウンが表示される。
      4. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
      5. Thunderbird以外のアプリケーションから任意のテキストを100文字以上コピーし、本文に貼り付ける。
         * 「社外秘」という文字列が含まれると別の送信前確認に該当してしまうため、「社外秘」という文字列は含めないようにする。
      6. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
      7. 「キャンセル」を押して確認のダイアログを閉じる。
      8. メール編集ウィンドウを閉じる。
4. すべての宛先が社内である場合に確認を省略する動作を検証する。
   1. FlexConfirmMailの設定画面を開く。
   2. 「宛先」→「すべての宛先が組織内のメール送信時は確認ダイアログを表示しない」にチェックを入れる。
   3. 3ペインのタブに切り替える。
   4. 新規にメール作成を開始する。
   5. 宛先に `piro-test+1@clear-code.com, piro-test+2@clear-code.com` を追加する。
   6. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれない。
      * [ ] カウントダウンが表示される。
   7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   8. 宛先に `external@example.com` を追加する。
   9. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] 組織内の宛先のチェックボックスが表示されている。
   10. 「キャンセル」を押して確認のダイアログを閉じる。
   11. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   12. 「宛先」→「組織外の宛先を含む場合も、組織内の宛先のチェックを省略する」にチェックを入れる。
   13. メール編集ウィンドウに戻る。
   14. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] 組織内の宛先のチェックボックスが表示されていない。
   15. すべてのチェックをオンにする。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   16. 「キャンセル」を押して確認のダイアログを閉じる。
   17. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   18. 「宛先」→「すべての宛先が組織内のメール送信時は確認ダイアログを表示しない」のチェックを外す。
   19. メール編集ウィンドウに戻る。
   20. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] 組織内の宛先のチェックボックスが表示されている。
   21. 「キャンセル」を押して確認のダイアログを閉じる。
   22. 宛先から `external@example.com` を削除する。
5. 宛先の件数によって確認を省略する動作を検証する。
   1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   2. 「宛先」→「宛先がN件以下の場合は確認ダイアログを表示しない」に「2」を入力する。
   3. メール編集ウィンドウに戻る。
   4. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれない。
      * [ ] カウントダウンが表示される。
   5. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   6. 宛先に `piro-test+3@clear-code.com` を追加する。
   7. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
   8. 「キャンセル」を押して確認のダイアログを閉じる。
   9. メール編集ウィンドウを閉じる。
   10. FlexConfirmMailの設定画面を開く。
   11. 「宛先」→「宛先がN件以下の場合は確認ダイアログを表示しない」に「0」を入力する。

#### 送信前の宛先確認で警告を行うかどうかの判断

1. ToまたはCcに含まれる外部の宛先のドメインの数によって警告を行う動作を検証する。
   1. 警告が行われない場合を検証する。
      1. FlexConfirmMailの設定画面を開く。
      2. 「宛先」→「ToまたはCcの宛先にN個以上のドメインが含まれる場合に警告する」にチェックを入れる。
      3. 3ペインのタブに切り替える。
      4. 新規にメール作成を開始する。
      5. 宛先に `piro.outsider.reflex@gmail.com` を追加する。
      6. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
      7. すべてのチェックをオンにする。
         * [ ] すべてにチェックが入った時点で「送信」が有効になる。
      8. 「送信」を押す。
         * [ ] カウントダウンが表示される。
      9. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   2. 警告が行われる場合を検証する。
      1. 宛先 `user1@example.com` を追加する。
      2. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
      3. すべてのチェックをオンにする。
         * [ ] すべてにチェックが入った時点で「送信」が有効になる。
      4. 「送信」を押す。
         * [ ] 宛先に複数のドメインが含まれる旨の警告が行われる。
      5. 「キャンセル」を押して警告のダイアログを閉じる。
      6. もう一度「送信」を押す。
         * [ ] 宛先に複数のドメインが含まれる旨の警告が行われる。
      7. 警告のダイアログの「送信」を押す。
         * [ ] カウントダウンが表示される。
      8. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   3. Bccに対して警告が行われないことを検証する。
      1. 宛先欄から `user1@example.com` を削除する。
      2. Bccに `user1@example.com, user1@example.org` を追加する。
      3. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
      4. すべてのチェックをオンにする。
         * [ ] すべてにチェックが入った時点で「送信」が有効になる。
      5. 「送信」を押す。
         * [ ] 宛先に複数のドメインが含まれる旨の警告が行われない。
         * [ ] カウントダウンが表示される。
      6. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
      7. メール編集ウィンドウを閉じる。
   4. FlexConfirmMailの設定画面を開く。
   5. 「宛先」→「ToまたはCcの宛先にN個以上のドメインが含まれる場合に警告する」のチェックを外す。
2. 既存メールへの返信で、既存の宛先にないドメインの宛先が追加されたときに強調表示と警告を行う動作を検証する。
   1. 強調表示と警告が行われる場合を検証する。
      1. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
      2. 宛先に `user1@example.com` を追加する。
      3. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
         * [ ] `user1@example.com` が赤字で強調表示される。
      4. すべてのチェックをオンにする。
         * [ ] すべてにチェックが入った時点で「送信」が有効になる。
      5. 「送信」を押す。
         * [ ] 追加された宛先の `user1@example.com` の確認を求めるダイアログが表示される。
      6. 「キャンセル」を押して警告のダイアログを閉じる。
      7. もう一度「送信」を押す。
         * [ ] 追加された宛先の `user1@example.com` の確認を求めるダイアログが表示される。
      8. 警告のダイアログの「送信」を押す。
         * [ ] カウントダウンが表示される。
      9. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   2. 強調表示のみ行われる場合を検証する。
      1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
      2. 「宛先」→「返信の宛先に今まで含まれていなかったドメインのアドレスが追加された場合に警告する」のチェックを外す。
      3. メール編集ウィンドウに戻る。
      4. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
         * [ ] `user1@example.com` が赤字で強調表示される。
      5. すべてのチェックをオンにする。
         * [ ] すべてにチェックが入った時点で「送信」が有効になる。
      6. 「送信」を押す。
         * [ ] 追加された宛先の確認を求めるダイアログが表示されない。
         * [ ] カウントダウンが表示される。
      7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   3. 警告のみ行われる場合を検証する。
      1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
      2. 「宛先」→「返信の宛先に今まで含まれていなかったドメインのアドレスが追加された場合に警告する」のチェックを入れる。
      3. 「その他」→「返信の宛先に今まで含まれていなかったドメインのアドレスを強調表示する」のチェックを外す
      4. メール編集ウィンドウに戻る。
      5. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
         * [ ] `user1@example.com` が赤字で強調表示されない。
      6. すべてのチェックをオンにする。
         * [ ] すべてにチェックが入った時点で「送信」が有効になる。
      7. 「送信」を押す。
         * [ ] 追加された宛先の `user1@example.com` の確認を求めるダイアログが表示される。
      8. 「キャンセル」を押して警告のダイアログを閉じる。
      9. 「キャンセル」を押して確認のダイアログを閉じる。
   4. 強調表示も警告も行われない場合を検証する。
      1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
      2. 「宛先」→「返信の宛先に今まで含まれていなかったドメインのアドレスが追加された場合に警告する」のチェックを外す。
      3. メール編集ウィンドウに戻る。
      4. 「送信」を押す。
         * [ ] チェックボックスがある確認画面が開かれる。
         * [ ] `user1@example.com` が赤字で強調表示されない。
      5. すべてのチェックをオンにする。
         * [ ] すべてにチェックが入った時点で「送信」が有効になる。
      6. 「送信」を押す。
         * [ ] 追加された宛先の確認を求めるダイアログが表示されない。
         * [ ] カウントダウンが表示される。
      7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
      8. メール編集ウィンドウを閉じる。
   5. FlexConfirmMailの設定画面を開く。
   6. 「宛先」→「返信の宛先に今まで含まれていなかったドメインのアドレスが追加された場合に警告する」のチェックを入れる。
   7. 「その他」→「返信の宛先に今まで含まれていなかったドメインのアドレスを強調表示する」のチェックを入れる。

#### 添付ファイルの確認

1. 確認のみ求められる場合を検証する。
   1. 新規にメール作成を開始する。
   2. 宛先に `piro-test+1@clear-code.com` を追加する。
   3. 画像ファイル `attachment/image.svg` を添付する。
   4. zipファイル `attachment/json.svg` を添付する。
   5. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] 添付ファイルセクションの見出しにチェックボックスがない。
      * [ ] 各添付ファイルにチェックボックスがあり、チェック状態を切り替え可能である。
   6. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   7. 「キャンセル」を押して確認のダイアログを閉じる。
2. 添付ファイル名の手動入力を求める場合を検証する。
   1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   2. 「添付ファイル」→「外部ドメイン・アドレスの宛先がある場合、添付ファイル名の手動での入力を求める」にチェックを入れる。
   3. メール編集ウィンドウに戻る。
   4. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] 添付ファイルセクションの見出しにチェックボックスがない。
      * [ ] 各添付ファイルにチェックボックスがあり、チェック状態を切り替え可能である。
   5. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   6. 「キャンセル」を押して確認のダイアログを閉じる。
   7. 宛先に `piro.outsider.reflex@gmail.com` を追加する。
   8.  「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] 添付ファイルセクションの見出しにチェックボックスがない。
      * [ ] 各添付ファイルにチェック状態切り替え不可能なチェックボックスと入力欄がある。
   9. 各添付ファイルの入力欄にファイル名を入力する。
      * [ ] 添付ファイル名が入力された行のチェックがオンになる。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   10. 「キャンセル」を押して確認のダイアログを閉じる。
2. 一括チェックの動作を検証する。
   1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   2. 「添付ファイル」→「添付ファイルのチェックボックスの一括制御を許可」にチェックを入れる。
   3. メール編集ウィンドウに戻る。
   4. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] 添付ファイルセクションの見出しにチェック状態切り替え不可能なチェックボックスがある。
      * [ ] 各添付ファイルにチェック状態切り替え不可能なチェックボックスと入力欄がある。
   5. 各添付ファイルの入力欄にファイル名を入力する。
      * [ ] 添付ファイル名が入力された行のチェックがオンになる。
      * [ ] すべての添付ファイル名が入力された時点で、添付ファイルのセクションの見出しのチェックボックスがオンになる。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   6. 「キャンセル」を押して確認のダイアログを閉じる。
   7. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   8. 「添付ファイル」→「外部ドメイン・アドレスの宛先がある場合、添付ファイル名の手動での入力を求める」のチェックを外す。
   9. メール編集ウィンドウに戻る。
   10. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] 添付ファイルセクションの見出しにチェック状態切り替え可能なチェックボックスがある。
       * [ ] 各添付ファイルにチェックボックスがあり、チェック状態を切り替え可能である。
   11. 添付ファイルセクション以外のすべてのチェックを入れる。
   12. 添付ファイルセクションの見出しのチェックを入れる。
       * [ ] 各添付ファイルのチェックボックスがすべてオンになる。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   13. 添付ファイルセクションの見出しのチェックを外す。
       * [ ] 各添付ファイルのチェックボックスがすべてオフになる。
       * [ ] 「送信」がグレイアウトしている。
   14. 「キャンセル」を押して確認のダイアログを閉じる。
   15. メール編集ウィンドウを閉じる。
3. FlexConfirmMailの設定画面を開く。
4. 「添付ファイル」→「添付ファイルのチェックボックスの一括制御を許可」にのチェックを外す。

#### 追加のルールの動作

1. 特別に注意が必要な宛先に対する常時の強調表示と常時の警告を検証する。
   1. 新規にメール作成を開始する。
   2. 宛先に `user1@example.net` を追加する。
   3. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] `user1@example.net` が強調表示される。
   4. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   6. 「送信」を押す。
      * [ ] `user1@example.net` があることの警告のダイアログが表示される。
   7. 「キャンセル」を押す。
      * [ ] 確認のダイアログに制御が戻る。
   8. もう一度「送信」を押す。
      * [ ] `user1@example.net` があることの警告のダイアログが表示される。
   9. 「送信」を押す。
      * [ ] カウントダウンが表示される。
   10. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   11. 「キャンセル」を押して確認のダイアログを閉じる。
2. 特別に注意が必要な添付ファイルに対する常時の強調表示と、外部の宛先がある場合のみの警告を検証する。
   1. すべての宛先を削除する。
   2. 宛先に `piro-test+1@clear-code.com` を追加する。
   3. 画像ファイル `attachment/image.png` を添付する。
   4. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] `image.png` が強調表示される。
   5. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   6. 「送信」を押す。
      * [ ] `image.png` があることの警告のダイアログが表示されない。
      * [ ] カウントダウンが表示される。
   7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   8. 宛先に `piro.outsider.reflex+1@gmail.com` を追加する。
   9. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] `image.png` が強調表示される。
   10. すべてのチェックをオンにする。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   11. 「送信」を押す。
       * [ ] `image.png` があることの警告のダイアログが表示される。
       * [ ] 警告内のファイル名部分が太字で強調表示される。
   12. 「キャンセル」を押す。
       * [ ] 確認のダイアログに制御が戻る。
   13. もう一度「送信」を押す。
       * [ ] `image.png` があることの警告のダイアログが表示される。
   14. 「送信」を押す。
       * [ ] カウントダウンが表示される。
   15. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
3. 外部の宛先がある場合のみの、特別に注意が必要な添付ファイルに対する強調表示と警告を検証する。
   1. すべての添付ファイル、すべての宛先を削除する。
   2. 宛先に `piro-test+1@clear-code.com` を追加する。
   3. テキストファイル `attachment/社外秘.txt` を添付する。
   4. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] `社外秘.txt` が強調表示されない。
   5. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   6. 「送信」を押す。
      * [ ] `社外秘.txt` があることの警告のダイアログが表示されない。
      * [ ] カウントダウンが表示される。
   7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   8. 宛先に `piro.outsider.reflex+1@gmail.com` を追加する。
   9. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] `社外秘.txt` が強調表示される。
   10. すべてのチェックをオンにする。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   11. 「送信」を押す。
       * [ ] `社外秘.txt` があることの警告のダイアログが表示される。
       * [ ] 警告内のファイル名部分が太字で強調表示される。
   12. 「キャンセル」を押す。
       * [ ] 確認のダイアログに制御が戻る。
   13. もう一度「送信」を押す。
       * [ ] `社外秘.txt` があることの警告のダイアログが表示される。
   14. 「送信」を押す。
       * [ ] カウントダウンが表示される。
   15. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
4. 外部の宛先がある場合のみの、本文に対する強調表示と警告を検証する。
   1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   2. 「その他」→「件名の確認を求める」にチェックを入れる。
   3. 「その他」→「メール本文の確認を求める」にチェックを入れる。
   4. メール編集ウィンドウに戻る。
   5. すべての添付ファイル、すべての宛先を削除する。
   6. 宛先に `piro-test+1@clear-code.com` を追加する。
   7. 件名を「社外秘」と入力する。
   8. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] 件名のチェックボックスのラベルが強調表示されない。
      * [ ] 本文のプレビューが強調表示されない。
   9. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   10. 「送信」を押す。
       * [ ] 件名、本文に「社外秘」があることの警告のダイアログが表示されない。
       * [ ] カウントダウンが表示される。
   11. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   12. 件名を消去する。
   13. 本文に「社外秘」と入力する。
   14. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] 件名のチェックボックスのラベルが強調表示されない。
       * [ ] 本文のプレビューが強調表示されない。
   15. すべてのチェックをオンにする。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   16. 「送信」を押す。
       * [ ] 件名、本文に「社外秘」があることの警告のダイアログが表示されない。
       * [ ] カウントダウンが表示される。
   17. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   18. 本文を消去する。
   19. 宛先に `piro.outsider.reflex+1@gmail.com` を追加する。
   20. 件名を「社外秘」と入力する。
   21. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] 件名のチェックボックスのラベルが強調表示される。
       * [ ] 本文のプレビューが強調表示されない。
   22. すべてのチェックをオンにする。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   23. 「送信」を押す。
       * [ ] 件名または本文に「社外秘」があることの警告のダイアログが表示される。
       * [ ] 警告内のキーワード部分が太字で強調表示される。
   24. 「キャンセル」を押す。
       * [ ] 確認のダイアログに制御が戻る。
   25. もう一度「送信」を押す。
       * [ ] 件名または本文に「社外秘」があることの警告のダイアログが表示される。
   26. 「送信」を押す。
       * [ ] カウントダウンが表示される。
   27. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   28. 件名を消去する。
   29. 本文に「社外秘」と入力する。
   30. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] 件名のチェックボックスのラベルが強調表示されない。
       * [ ] 本文のプレビューが強調表示される。
   31. すべてのチェックをオンにする。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   32. 「送信」を押す。
       * [ ] 件名または本文に「社外秘」があることの警告のダイアログが表示される。
       * [ ] 警告内のキーワード部分が太字で強調表示される。
   33. 「キャンセル」を押す。
       * [ ] 確認のダイアログに制御が戻る。
   34. もう一度「送信」を押す。
       * [ ] 件名または本文に「社外秘」があることの警告のダイアログが表示される。
   35. 「送信」を押す。
       * [ ] カウントダウンが表示される。
   36. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
5. 送信を禁止する宛先を検証する。
   1. 宛先に `user1@danger.example.com` を追加する。
   2. 「送信」を押す。
      * [ ] `user1@danger.example.com` があることの警告のダイアログが表示される。
      * [ ] チェックボックスがある確認画面が開かれない。
   3. 「閉じる」を押す。
      * [ ] カウントダウンが表示されない。
      * [ ] メールが送信されない。
9. メール編集ウィンドウを閉じる。
10. FlexConfirmMailの設定画面を開く。
11. 「その他」→「件名の確認を求める」のチェックを外す。
12. 「その他」→「メール本文の確認を求める」のチェックを外す。

#### 送信前カウントダウンの動作

1. カウントダウン秒数の変更/カウントダウン省略の禁止を検証する。
   1. FlexConfirmMailの設定画面を開く。
   2. 「その他」→「[送信]ボタンを押してからN秒間のカウントダウン後に実際に送信する」の秒数に「300」を入力する。
   3. 「その他」→「カウントを飛ばしてすぐに送信することを許容する」のチェックを外す。
   4. 3ペインのタブに切り替える。
   5. 「社外の人とのやり取りのメール」を選択し、「全員に返信」ボタンを押す。
   6. 「送信」を押す。
      * [ ] 確認のダイアログが開かれない。
      * [ ] カウントダウンが表示される。
      * [ ] カウントダウンの残り秒数が300から始まる。
      * [ ] カウントダウンのダイアログに「キャンセル」ボタンのみがあり、カウントを省略するボタンがない。
   7. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
2. カウントダウンの無効化を検証する。
   1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   2. 「その他」→「[送信]ボタンを押してからN秒間のカウントダウン語に実際に送信する」のチェックを外す。
   3. メール編集ウィンドウに戻る。
   4. すべての添付ファイル、すべての宛先を削除する。
   5. 「送信」を押す。
      * [ ] 確認のダイアログが開かれない。
      * [ ] カウントダウンが表示されない。
   6. メール送信を中止できればする。
   7. メール編集ウィンドウが残留していれば閉じる。
3. FlexConfirmMailの設定画面を開く。
4. 「その他」→「[送信]ボタンを押してからN秒間のカウントダウン語に実際に送信する」のチェックを入れ、秒数に「10」を入力する。
5. 「その他」→「カウントを飛ばしてすぐに送信することを許容する」のチェックを入れる。

#### 表示・確認対象のカスタマイズ

1. 件名、本文の確認の動作を検証する。
   1. FlexConfirmMailの設定画面を開く。
   2. 「その他」→「件名の確認を求める」にチェックを入れる。
   3. 「その他」→「メール本文の確認を求める」にチェックを入れる。
   4. 3ペインのタブに切り替える。
   5. 新規にメール作成を開始する。
   6. 宛先に `piro-test+1@clear-code.com, piro.outsider.reflex+1@gmail.com, piro.outsider.reflex+2@gmail.com, user1@example.com, user1@example.org, user1@example.jp` を追加する。
   7. 件名を「社内外宛」と入力する。
   8. 本文を以下の通り入力する。
      ```
      1行目
      2行目
      3行目
      4行目
      5行目
      ```
   9. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] 件名の確認欄があり、件名が件名欄のとおり表示される。
      * [ ] 本文の確認欄があり、内容が本文に入力したとおり表示される。
      * [ ] メールアドレス横の「To」「Cc」「Bcc」がメールアドレスより大きいフォントサイズである。
      * [ ] 組織外の宛先のグループがすべて同じ色で表示される（特に色分けされない）。
   10. すべてのチェックをオンにする。
       * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   11. 確認のダイアログを1000×500など極端な横長または縦長にリサイズする。
   12. 「送信」を押す。
       * [ ] カウントダウンが表示される。
   13. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   14. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] ダイアログが前回リサイズ後の大きさで開かれる。
   15. 「キャンセル」を押して確認のダイアログを閉じる。
2. 強調表示の切り替えを検証する。
   1. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   2. 「その他」→「外部の宛先のアドレスを強調表示する」にチェックを入れる。
   3. 「その他」→「メールアドレスを大きなフォントサイズで表示する」にチェックを入れる。
   4. 「その他」→「確認のダイアログの冒頭メッセージ」に「送信前にご確認ください！！」と入力する。
   5. 「その他」→「宛先の種別（To/Cc/Bcc）を強調表示する」のチェックを外す。
   6. 3ペインのタブに切り替える。
   7. メール編集ウィンドウに戻る。
   8. 「送信」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] ダイアログが前回リサイズ後の大きさで開かれる。
      * [ ] ダイアログ最上部に「送信前にご確認ください！！」と強調表示される。
      * [ ] メールアドレス横の「To」「Cc」「Bcc」がメールアドレスと同じフォントサイズである。
      * [ ] 組織外の宛先のグループが偶数・奇数で色分け表示される。
   9. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   10. 「キャンセル」を押して確認のダイアログを閉じる。
   11. メール編集ウィンドウをそのまま残し、FlexConfirmMailの設定画面を開く。
   12. 「その他」→「確認のダイアログを常に大きなサイズで開く」のチェックを入れる。
   13. 「その他」→「確認のダイアログの冒頭メッセージ」→「メッセージを強調表示する」のチェックを外す。
   14. メール編集ウィンドウに戻る。
   15. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] ダイアログ最上部に「送信前にご確認ください！！」と通所の文字で表示される。
       * [ ] ダイアログウィンドウが大きなサイズで表示される。
   16. 確認のダイアログを1000×500など極端な横長または縦長にリサイズする。
   17. 「送信」を押す。
       * [ ] カウントダウンが表示される。
   18. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   19. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] ダイアログウィンドウが前回リサイズ後のサイズではなく大きなサイズで表示される。
   20. 確認のダイアログを1000×500など極端な横長または縦長にリサイズする。
   21. 「送信」を押す。
       * [ ] カウントダウンが表示される。
   22. 「キャンセル」を押してカウントダウンのダイアログを閉じる。
   23. 「送信」を押す。
       * [ ] チェックボックスがある確認画面が開かれる。
       * [ ] ダイアログウィンドウが前回リサイズ後のサイズではなく大きなサイズで表示される。
   24. 「キャンセル」を押して確認のダイアログを閉じる。
3. システムの配色設定への対応状況を検証する。
   1. メール編集ウィンドウをそのまま残し、システムの配色を明るい配色に変更する。
      Windows 11では、「個人用設定」の「色」で「既定のアプリ モードを選択します」を「ライト」に設定する。
   2. メール編集ウィンドウに戻る。
   3. 「送信」を押す。
      * [ ] すべてのチェックボックスのラベルが判読可能な色で表示される。
      * [ ] 本文プレビューが判読可能な色で表示される。
   4. 「キャンセル」を押して確認のダイアログを閉じる。
   5. メール編集ウィンドウをそのまま残し、システムの配色を暗い配色に変更する。
      Windows 11では、「個人用設定」の「色」で「既定のアプリ モードを選択します」を「ダーク」に設定する。
   6. メール編集ウィンドウに戻る。
   7. 「送信」を押す。
      * [ ] すべてのチェックボックスのラベルが判読可能な色で表示される。
      * [ ] 本文プレビューが判読可能な色で表示される。
   8. 「キャンセル」を押して確認のダイアログを閉じる。
   9. メール編集ウィンドウを閉じる。

#### 英語でのダイアログ

1. 既存メールへの返信で、既存の宛先にないドメインの宛先が追加されたときの警告を検証する。
   1. 「社外の人とのやり取りのメール」を選択し、「Reply All」ボタンを押す。
   2. 宛先に `user1@example.com` を追加する。
   3. 「Send」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] `user1@example.com` が赤字で強調表示される。
   4. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   5. 「Send」を押す
      * [ ] 追加された宛先の `user1@example.com` の確認を求めるダイアログが表示される。
   6. 「Cancel」を押して警告のダイアログを閉じる。
   7. 「Cancel」を押して確認のダイアログを閉じる。
   8. メール編集ウィンドウを閉じる。

#### 中国語でのダイアログ

1. 既存メールへの返信で、既存の宛先にないドメインの宛先が追加されたときの警告を検証する。
   1. 「社外の人とのやり取りのメール」を選択し、「全部回复」ボタンを押す。
   2. 宛先に `user1@example.com` を追加する。
   3. 「发送」を押す。
      * [ ] チェックボックスがある確認画面が開かれる。
      * [ ] `user1@example.com` が赤字で強調表示される。
   4. すべてのチェックをオンにする。
      * [ ] すべてにチェックが入った時点で「送信」が有効になる。
   5. 「发送」を押す
      * [ ] 追加された宛先の `user1@example.com` の確認を求めるダイアログが表示される。
   6. 「取消」を押して警告のダイアログを閉じる。
   7. 「取消」を押して確認のダイアログを閉じる。
   8. メール編集ウィンドウを閉じる。
